!function(){"use strict";angular.module("kinvey",["ngResource","base64"]).constant("$kUrl",{base:"https://baas.kinvey.com/",appdata:"appdata/",user:"user/",group:"group/",rpc:"rpc/",custom:"custom/",blob:"blob/",push:"push/"}).constant("$kVer",3).constant("$kHead",{user:{"X-Kinvey-API-Version":"",Authorization:""},basic:{"X-Kinvey-API-Version":"",Authorization:""}}).constant("$kErr",{init:"$kinveyProvider.init requires an options object: {'appId':'YOUR APP ID','appSecret':'YOUR APP SECRET'}",alias:"aliases must not attempt to overwrite $kinvey."}).constant("$kSerialize",function(a,b){function c(a){return a&&a.document&&a.location&&a.alert&&a.setInterval}function d(a){return a&&a.$evalAsync&&a.$watch}function e(a,b){var e=b;if("string"==typeof a&&"$"===a.charAt(0)){var g=!1;angular.forEach(f,function(b){b==a&&(g=!0)}),g||(e=void 0)}else c(b)?e="$WINDOW":b&&document===b?e="$DOCUMENT":d(b)&&(e="$SCOPE");return e}var f=["$gt","$gte","$in","$lt","$lte","$ne","$nin","$or","$and","$not","$nor","$exists","$type","$mod","$regex","$where","$geoWithin","$geoIntersects","$near","$nearSphere","$all","$elemMatch","$size","$","$elemMatch","$slice"];return"undefined"==typeof a?void 0:JSON.stringify(a,e,b?"  ":null)}).constant("$kStorageAdapter",function(a){return{get:function(b){return a[b]},put:function(b,c){a[b]=c},remove:function(b){a[b]=null}}}).constant("$kRequire",function(a,b,c,d){var e=angular.injector(["ng",a,"kinvey"]),f=e.instantiate(b.$get),g=e.get("$rootScope");return d.$watch(function(){g.$apply()}),f}).provider("$kinvey",["$kUrl","$kHead","$kVer","$kErr","$kSerialize","$kStorageAdapter","$kRequire","$base64","$injector",function(a,b,c,d,e,f,g,h,i){b.user["X-Kinvey-API-Version"]=c,b.basic["X-Kinvey-API-Version"]=c;var j,k;return{init:function(a){if(!(a&&"appKey"in a&&"appSecret"in a))throw d.init;j=a.appKey,k=a.storage;var c="Basic "+h.encode(a.appKey+":"+a.appSecret);b.user.Authorization=c,b.basic.Authorization=c},$get:["$rootScope","$resource","$http","$q",function(c,h,l,m){function n(a,b){var c=m.defer(),d=b||{};return"$resolved"in d||(d.$resolved=!1),d.$promise=c.promise,a(d,c),d}function o(a,b,c){return function(d){var e=c?c(d):d;angular.extend(a,e),a.$resolved=!0,b.resolve(e)}}function p(a,b){return function(c){var d=b?b(c):c;a.reject(d)}}function q(a){angular.forEach(J,function(b){var c=a[b];a[b]=function(a,b,d,e){return a&&"query"in a&&(a.query=JSON.stringify(a.query)),c(a,b,d,e)}});var b=a.group;return a.group=function(a,c,d){return a.reduce&&(a.reduce=a.reduce.toString(),a.reduce=a.reduce.replace(/\n/g,""),a.reduce=a.reduce.replace(/\s/g,"")),b(void 0,a,c,d)},a}function r(a){return a.prototype.$download=function(){var a=this;return n(function(b,c){l(I.download(a)).then(o(b,c,u),p(c,u))})},a.prototype.$upload=function(a,b){var c=this;return n(function(d,e){l(I.upload(c,a,b)).then(o(d,e,u),p(e,u))})},a.prototype.$save=function(a){var b=this;return n(function(c,d){l(I.saveFile(y(b),a)).then(o(c,d,v),p(d,u))},b)},a.prototype.$reference=function(){return this._id?{_type:"KinveyFile",_id:this._id}:void 0},a.upload=function(a,b,c){return n(function(d,e){l(I.upload(a,b,c)).then(o(d,e,u),p(e,u))})},a.download=function(a){return n(function(b,c){l(I.download(a)).then(o(b,c,u),p(c,u))})},a.save=function(a,b){return n(function(c,d){l(I.saveFile(y(a),b)).then(o(c,d,v),p(d,u))},a)},a}function s(a,b){return b.save=function(b){return b._id?K(a).update(b):K(a).create(b)},b.prototype.$save=function(a){return a&&a._id&&!this._id&&(this._id=a._id),this._id?this.$update(a):this.$create(a)},b}function t(a,b){return b.prototype.$reference=function(){return this._id?{_type:"KinveyRef",_collection:a,_id:this._id}:void 0},b}function u(a){return a.data}function v(a){return new N(u(a))}function w(){return n(function(a,b){l(I.handshake()).then(o(a,b,u),p(b,u))})}function x(a,b){return n(function(c,d){l(I.rpc(a,b)).then(o(c,d,u),p(d,u))})}function y(a){var b={};return b=angular.copy(a),angular.forEach(b,function(a,c){"object"==typeof a&&(b[c]="$reference"in a&&"function"==typeof a.$reference?a.$reference():y(a))}),b}function z(a,b){if(a===b)throw d.alias+b}function A(a,b){z(b,"handshake"),z(b,"User"),z(b,"Group"),z(b,"Object"),z(b,"alias"),P[b]=K(a)}var B;switch(k){case"cookies":var C=i.get("$cookieStoreProvider"),D=g("ngCookies",C,i,c);B=D;break;case"local":var E=i.get("$localStorageProvider"),F=g("ngStorage",E,i,c);B=f(F);break;default:var G={};B={get:function(a){return G[a]},put:function(a,b){G[a]=b},remove:function(a){G[a]=void 0}}}var H=B.get(j+":authToken");H&&(b.user.Authorization=H);var I={handshake:function(){return{method:"GET",url:a.base+a.appdata+j,headers:b.basic}},rpc:function(c,d){return{method:"POST",url:a.base+a.rpc+j+"/"+a.custom+c,headers:b.user,data:d}},upload:function(a,b,c){return{method:"PUT",url:a._uploadURL,data:b,headers:angular.extend({"Content-Type":c,Accept:void 0},a._requiredHeaders),transformRequest:angular.identity}},download:function(a){return{method:"GET",url:a._downloadURL}},saveFile:function(c,d){return{method:c._id?"PUT":"POST",url:a.base+a.blob+j+(c._id?"/"+c._id:""),headers:angular.extend({"X-Kinvey-Content-Type":d},b.user),data:c}}},J=["query","delete"],K=function(c){return t(c,s(c,q(h(a.base+a.appdata+j+"/"+c+"/:_id",{_id:"@_id"},{create:{method:"POST",transformResponse:function(a){return new(K(c))(angular.fromJson(a))},transformRequest:function(a){var b=y(a);return angular.toJson(b)},headers:b.user,params:{_id:""}},get:{method:"GET",transformResponse:function(a){return new(K(c))(angular.fromJson(a))},headers:b.user},count:{method:"GET",headers:b.user,params:{_id:"_count"}},update:{method:"PUT",transformResponse:function(a){return new(K(c))(angular.fromJson(a))},transformRequest:function(a){var b=y(a);return angular.toJson(b)},headers:b.user},"delete":{method:"DELETE",headers:b.user},query:{method:"GET",transformResponse:function(a){var b=[],d=angular.fromJson(a);return angular.forEach(d,function(a){b.push(new(K(c))(a))}),b},headers:b.user,isArray:!0,params:{_id:""}},group:{method:"POST",headers:b.user,isArray:!0,params:{_id:"_group"},transformRequest:function(a){return e(a)}}}))))},L=t("user",q(h(a.base+a.user+j+"/:_id",{_id:"@_id"},{login:{method:"POST",params:{_id:"login"},transformResponse:function(a){return a=angular.fromJson(a),a.error||(b.user.Authorization="Kinvey "+a._kmd.authtoken,B.put(j+":authToken","Kinvey "+a._kmd.authtoken)),new L(a)},transformRequest:function(a){return angular.toJson(y(a))},headers:b.user},current:{method:"GET",params:{_id:"_me"},transformResponse:function(a){return new L(angular.fromJson(a))},headers:b.user},logout:{method:"POST",params:{_id:"_logout"},transformResponse:function(){b.user.Authorization=b.basic.Authorization,B.remove(j+":authToken")},headers:b.user},signup:{method:"POST",headers:b.basic,transformResponse:function(a){return a=angular.fromJson(a),a.error||(b.user.Authorization="Kinvey "+a._kmd.authtoken,B.put(j+":authToken","Kinvey "+a._kmd.authtoken)),new L(a)},transformRequest:function(a){return angular.toJson(y(a))}},get:{method:"GET",transformResponse:function(a){return new L(angular.fromJson(a))},headers:b.user},lookup:{method:"POST",transformResponse:function(a){var b=[];return a=angular.fromJson(a),angular.forEach(a,function(a){b.push(new L(a))}),b},headers:b.user,isArray:!0,params:{_id:"_lookup"}},save:{method:"PUT",transformResponse:function(a){return new L(angular.fromJson(a))},transformRequest:function(a){return angular.toJson(y(a))},headers:b.user},query:{url:a.base+a.user+j+"/?query=:query",method:"GET",transformResponse:function(a){var b=[];return a=angular.fromJson(a),angular.forEach(a,function(a){b.push(new L(a))}),b},headers:b.user,isArray:!0,params:{}},"delete":{method:"DELETE",params:{hard:!0},headers:b.user},suspend:{method:"DELETE",headers:b.user},verifyEmail:{method:"POST",headers:{Authorization:b.basic.Authorization,"X-Kinvey-API-Version":b.basic["X-Kinvey-API-Version"],"Content-Type":void 0},url:a.base+a.rpc+j+"/:username:email/user-email-verification-initiate",params:{username:"@username",email:"@email"},transformRequest:function(){return""}},resetPassword:{method:"POST",headers:b.basic,url:a.base+a.rpc+j+"/:username:email/user-password-reset-initiate",params:{username:"@username",email:"@email"},transformRequest:function(){return""}},checkUsernameExists:{method:"POST",headers:b.basic,url:a.base+a.rpc+j+"/check-username-exists"}}))),M=h(a.base+a.group+j+"/:_id",{_id:"@_id"},{get:{method:"GET",headers:b.user},save:{method:"PUT",headers:b.user},"delete":{method:"DELETE",headers:b.user}}),N=r(q(h(a.base+a.blob+j+"/:_id",{_id:"@_id"},{get:{method:"GET",headers:b.user,transformResponse:function(a){return new N(angular.fromJson(a))}},query:{method:"GET",headers:b.user,isArray:!0,params:{_id:""},transformResponse:function(a){var b=[];return angular.forEach(angular.fromJson(a),function(a){b.push(new N(a))}),b}},"delete":{method:"DELETE",headers:b.user}}))),O=h(a.base+a.push+j+"/:verb",{verb:"@verb"},{register:{method:"POST",headers:b.user,params:{verb:"register-device"}},unregister:{method:"POST",headers:b.user,params:{verb:"unregister-device"}}}),P={handshake:w,User:L,Group:M,Object:K,File:N,Push:O,alias:A,rpc:x};return P}]}}])}();